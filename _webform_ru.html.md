# Форма выставления счета {#http}

###### Последнее обновление: 2017-06-15 | [Редактировать на GitHub](https://github.com/QIWI-API/bill-payments-rest-api-docs/blob/master/_webform_ru.html.md)

Клиенту отображается платежная форма с выбором способа оплаты выставленного счета.

* Вызов веб-формы может выполняться двумя способами:

  * Простой. Для идентификации провайдера используется ключ в параметрах вызова.

  * С подписью. В параметрах вызова содержится цифровая подпись, которая гарантирует, что счет выставляет конкретный провайдер.

### Последовательность операций:

1. Пользователь формирует заказ на сайте провайдера.
2. Далее провайдер выполняет переадресацию на [платежную форму](#checkout) QIWI Кассы
3. Клиент выбирает наиболее удобный способ оплаты и оплачивает счет.
4. Если провайдер включил отправку [уведомлений на сервер провайдера](#notification), то после проведения платежа QIWI Касса высылает уведомление на сервер провайдера об оплате данного счета. Уведомления об оплате счета содержат параметры авторизации, которые необходимо проверять на сервере провайдера.
5. После подтверждения оплаты счета провайдер исполняет заказ пользователя.

<h3 class="request method">REDIRECT → </h3>

<ul class="nestedList url">
    <li><h3>URL <span>https://oplata.qiwi.com/form/</span></h3></li>
</ul>

~~~http
  Простое открытие формы
GET /form/create?public_key=08hvq08yw4fqw&amount=100.0&success_url=http%3A%2F%2Ftest.ru%3F&email=m@ya.ru HTTP/1.1
Host: oplata.qiwi.com
~~

~~~http
  C подписью
GET /form/create?public_key=08hvq08yw4fqw&bill_id=Bill-1&sign=09jvrq09pwh3rq2e2&amount=100.0 HTTP/1.1
Host: oplata.qiwi.com
~~~

<ul class="nestedList params">
    <li><h3>Параметры</h3><span>В ссылке на веб-форму указываются параметры счета.</span></li>
</ul>





Параметр|Описание|Тип|С подписью|Простой|Обяз.
---------|--------|---|---------|---|----
public_key | Ключ идентификации провайдера.|String|+|+|+
bill_id|Уникальный идентификатор счета в системе провайдера|String(30)|+|+|С подписью
amount| Сумма, на которую выставляется счет. Способ округления зависит от валюты | Number(6.3)|+|+|С подписью
sign|[Подпись запроса](#http_sign)|String|+|-|-
phone | Идентификатор QIWI Wallet, на который выставляется счет (в международном формате). | String(20)|+|+|-
email | E-mail пользователя, куда будет отправлена ссылка для оплаты счета. | String|+|+|-
user_id | Идентификатор пользователя в системе провайдера. | String|+|+|-
comment | Комментарий к счету.|String(255)|+|+|-
extra_\*|Дополнительные данные счета.|String(255)|+|+|-
lifetime | Дата, до которой счет будет доступен для оплаты. Если счет не будет оплачен до этой даты, ему присваивается финальный статус и последующая оплата станет невозможна.<br> **Внимание! По истечении 28 суток от даты выставления счет автоматически будет переведен в финальный статус.**|URL-закодированная строка ГГГГ-ММ-ДДTЧЧММ|+|+|-
success_url|URL для переадресации в случае успешного создания транзакции в Visa Qiwi Wallet. Ссылка должна вести на сайт провайдера. Если пользователь выбрал на платежной форме способ оплаты, отличный от оплаты с баланса Visa QIWI Wallet, то переадресация на сайт провайдера не выполняется.|URL-закодированная строка|+|+|-
fail_url|URL для переадресации в случае неуспеха при создании транзакции в Visa Qiwi Wallet. Ссылка должна вести на сайт провайдера. Если пользователь выбрал на платежной форме способ оплаты, отличный от оплаты с баланса Visa QIWI Wallet, то переадресация на сайт провайдера не выполняется.|URL-закодированная строка|+|+|-
pay_source |Способ оплаты по умолчанию, который необходимо отобразить пользователю при открытии платежной формы. Форма сама определяет наиболее удобный способ оплаты для клиента, поэтому <b>не советуем указывать</b> этот параметр. Возможные значения:<br>`qw` – оплата с баланса Visa QIWI Wallet;<br> `mobile` – оплата с баланса мобильного телефона;<br> `card` – оплата банковской картой;<br>Если способ оплаты не доступен, пользователю отображается предупреждение, при этом на странице можно выбрать другие способы оплаты. |String|-|+|-

## Подпись {#http_sign}

Вызов веб-формы выставления счета с авторизацией требует вычисления параметра `sign` (цифровой подписи).

<aside class="notice">
Для вычисления подписи используется API password – пароль, соответствующий <a href='#auth_param'>API_ID</a>
</aside>

Алгоритм вычисления подписи:

1.	Получить строку, содержащую значения всех обязательных параметров GET-запроса и параметра `lifetime` (если он присутствует в запросе) в алфавитном порядке перечисления параметров, разделенных символами `|`:

    `Invoice_parameters = "{api_id}|{currency}|{from}|{lifetime}|{summ}|{txn_id}"`

    где `{parameter}` – значение соответствующего параметра запроса.

2.	Вычислить HMAC-хэш с шифрованием SHA256 от полученной строки и ключом, равным API password (пароль к API ID):

    `sign = HMAС(SHA256, API_password, Invoice_parameters)`

