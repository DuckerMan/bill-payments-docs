# Форма выставления счета {#http}

###### Последнее обновление: 2017-06-15 | [Редактировать на GitHub](https://github.com/QIWI-API/bill-payments-rest-api-docs/blob/master/_webform_ru.html.md)

Клиенту отображается платежная форма с выбором способа оплаты выставленного счета.

* Вызов веб-формы может выполняться двумя способами:

  * WF - Без авторизации. Для идентификации провайдера используется ключ в параметрах вызова.

  * WF/auth - В параметрах вызова содержится цифровая подпись. Клиент может указать свой идентификатор (номер телефона, электронная почта) непосредственно на веб-форме.

### Последовательность операций:

1. Пользователь формирует заказ на сайте провайдера.
2. Далее провайдер выполняет вызов веб-формы. В запросе может использоваться авторизация провайдера. В способе WF w/auth при отсутствии номера телефона в параметрах вызова пользователь указывает свой номер телефона на форме.
3. В случае успешного создания счета пользователь автоматически переходит на [платежную форму](#checkout) Visa QIWI Wallet.
4. Если провайдер включил отправку [уведомлений на сервер провайдера](#notification), то после проведения платежа система Visa QIWI Wallet высылает уведомление на сервер провайдера об оплате данного счета, либо, если пользователь отклонил счет, о неоплате. Уведомления об оплате счета содержат параметры авторизации, которые необходимо проверять на сервере провайдера.
5. После подтверждения оплаты счета провайдер исполняет заказ пользователя.

<h3 class="request method">REDIRECT → </h3>

<ul class="nestedList url">
    <li><h3>URL <span>https://oplata.qiwi.com/form/create</span></h3></li>
</ul>

~~~http
  Без авторизации
GET /form/create?public_key=08hvq08yw4fqw&amount=100.0&success_url=http%3A%2F%2Ftest.ru%3F&email=m@ya.ru HTTP/1.1
Host: oplata.qiwi.com
~~~

<ul class="nestedList example">
    <li><h3>Пример без авторизации</h3><a>https://oplata.qiwi.com/form/create?public_key=08hvq08yw4fqw&amount=100.0&success_url=http%3A%2F%2Ftest.ru%3F&email=m@ya.ru</a>
    </li>
</ul>

~~~http
  C авторизацией
GET /form/create?public_key=08hvq08yw4fqw&bill_id=Bill-1&sign=09jvrq09pwh3rq2e2&amount=100.0 HTTP/1.1
Host: oplata.qiwi.com
~~~

<ul class="nestedList example">
    <li><h3>Пример c авторизацией</h3><a>https://oplata.qiwi.com/form/create?public_key=08hvq08yw4fqw&bill_id=Bill-1&sign=09jvrq09pwh3rq2e2&amount=100.0</a>
    </li>
</ul>

<ul class="nestedList params">
    <li><h3>Параметры</h3><span>В ссылке на веб-форму указываются параметры счета.</span></li>
</ul>





Параметр|Описание|Тип|WF/auth|WF|Обяз.
---------|--------|---|---------|---|----
public_key | Ключ идентификации провайдера. Равен Base58 хешированному набору параметров вида: `prv_id | api_id | currency`, где<br>prv_id - [идентификатор сайта](#auth_param) провайдера в API<br>api_id - [идентификатор](#auth_param) для авторизации в API<br>currency - идентификатор валюты (Alpha-3 ISO 4217 код). Может использоваться любая валюта, предусмотренная договором с КИВИ.|String|+|+|+
bill_id|Уникальный идентификатор счета в системе провайдера|String(30)|+|+|WF/auth
amount| Сумма, на которую выставляется счет. Способ округления зависит от валюты | Number(6.3)|+|+|WF/auth
sign|[Подпись запроса](#http_sign)|String|+|-|+
phone | Идентификатор QIWI Wallet, на который выставляется счет (в международном формате). | String(20)|+|+|-
email | E-mail пользователя, куда будет отправлена ссылка для оплаты счета. | String|+|+|-
user_id | Идентификатор пользователя в системе провайдера. | String|+|+|-
comm | Комментарий к счету.|String(255)|+|+|-
extra_\*|Дополнительные данные счета.|String(255)|+|+|-
lifetime | Дата, до которой счет будет доступен для оплаты. Если счет не будет оплачен до этой даты, ему присваивается финальный статус и последующая оплата станет невозможна.<br> **Внимание! По истечении 28 суток от даты выставления счет автоматически будет переведен в финальный статус.**|URL-закодированная строка ГГГГ-ММ-ДДTЧЧММ|+|+|-
success_url|URL для переадресации в случае успешного создания транзакции в Visa Qiwi Wallet. Ссылка должна вести на сайт провайдера. Если пользователь выбрал на платежной форме способ оплаты, отличный от оплаты с баланса Visa QIWI Wallet, то переадресация на сайт провайдера не выполняется.|URL-закодированная строка|+|+|-
fail_url|URL для переадресации в случае неуспеха при создании транзакции в Visa Qiwi Wallet. Ссылка должна вести на сайт провайдера. Если пользователь выбрал на платежной форме способ оплаты, отличный от оплаты с баланса Visa QIWI Wallet, то переадресация на сайт провайдера не выполняется.|URL-закодированная строка|+|+|-
pay_source |Способ оплаты по умолчанию, который необходимо отобразить пользователю при открытии платежной формы. Возможные значения:<br>`qw` – оплата с баланса Visa QIWI Wallet;<br> `mobile` – оплата с баланса мобильного телефона;<br> `card` – оплата банковской картой;<br> `wm` – оплата с привязанного кошелька WebMoney;<br> `ssk` – оплата наличными в терминале QIWI.<br>Если способ оплаты не доступен, пользователю отображается предупреждение, при этом на странице можно выбрать другие способы оплаты. |String|-|+|-

## Подпись {#http_sign}

Вызов веб-формы выставления счета с авторизацией требует вычисления параметра `sign` (цифровой подписи).

<aside class="notice">
Для вычисления подписи используется API password – пароль, соответствующий <a href='#auth_param'>API_ID</a>
</aside>

Алгоритм вычисления подписи:

1.	Получить строку, содержащую значения всех обязательных параметров GET-запроса и параметра `lifetime` (если он присутствует в запросе) в алфавитном порядке перечисления параметров, разделенных символами `|`:

    `Invoice_parameters = "{api_id}|{currency}|{from}|{lifetime}|{summ}|{txn_id}"`

    где `{parameter}` – значение соответствующего параметра запроса.

2.	Вычислить HMAC-хэш с шифрованием SHA256 от полученной строки и ключом, равным API password (пароль к API ID):

    `sign = HMAС(SHA256, API_password, Invoice_parameters)`

~~~php
<?php

?>
~~~
